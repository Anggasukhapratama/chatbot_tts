{% extends "_base.html" %}
{% block content %}
<div class="grid">
  <section class="card">
    <h2>🎙️ Upload & Transkrip Siaran (STT)</h2>
    <p class="muted">Unggah rekaman (wav/mp3/m4a/ogg...) untuk ditranskrip otomatis.</p>

    <form action="{{ url_for('transcription.transcribe') }}" method="post" enctype="multipart/form-data" class="form-grid">
      <div class="form-group">
        <label for="program">Nama Acara/Program</label>
        <input id="program" type="text" name="program" placeholder="Contoh: Berita Pagi" required>
      </div>

      <div class="form-group">
        <label for="audio">File Audio</label>
        <input id="audio" type="file" name="audio" accept="audio/*" required>
      </div>

      <fieldset class="form-group">
        <legend>Mode Pemilihan Model</legend>
        <div class="inline">
          <label class="radio">
            <input type="radio" name="mode" value="auto" checked>
            <span>Otomatis (≤30m: small, &gt;30m: medium)</span>
          </label>
          <label class="radio">
            <input type="radio" name="mode" value="manual">
            <span>Manual</span>
          </label>
          <select name="model_choice" aria-label="Pilih model (jika Manual)">
            <option value="tiny">tiny (sangat cepat, akurasi rendah)</option>
            <option value="base">base (cepat, akurasi cukup)</option>
            <option value="small" selected>small (seimbang)</option>
            <option value="medium">medium (lebih akurat, lebih lambat)</option>
          </select>
        </div>
      </fieldset>

      <div class="form-group inline">
        <label class="check">
          <input type="checkbox" name="chunk">
          <span>Potong otomatis tiap 10 menit (disarankan untuk rekaman panjang)</span>
        </label>
        <label class="check">
          <input type="checkbox" name="summary">
          <span>Buat ringkasan setelah transkrip (GPT bila tersedia, fallback lokal)</span>
        </label>
      </div>

      <div class="form-actions">
        <button class="btn" type="submit">Transkrip Sekarang</button>
      </div>
    </form>

    {% if cp %}
      <p class="hint">🔴 Sedang tayang: <b>{{ cp[0] }}</b>{% if cp[1] %} (host: {{ cp[1] }}){% endif %}</p>
    {% endif %}
  </section>

  <section class="card">
    <h2>🤖 Web Chatbot</h2>
    <p class="muted">UI chat tersedia di halaman <a href="{{ url_for('chatbot.chat_page') }}">Web Chatbot</a>.</p>
    <ul class="list">
      <li><code>jadwal</code> — lihat jadwal hari ini</li>
      <li><code>siaran</code> — program yang sedang tayang</li>
      <li><code>lagu sekarang</code> — status lagu/stream</li>
      <li><code>request Judul - Artis</code> — kirim request lagu</li>
    </ul>
    <a class="btn" href="{{ url_for('chatbot.chat_page') }}">Buka Chat</a>
  </section>

  <section class="card">
    <h2>📚 Transkrip Terbaru</h2>
    {% if transcripts %}
      <table class="table">
        <thead><tr><th>Waktu</th><th>Program</th><th>File</th><th></th></tr></thead>
        <tbody>
        {% for t in transcripts %}
          <tr>
            <td class="muted">{{ t['created_at'] }}</td>
            <td>{{ t['program'] }}</td>
            <td class="muted">{{ t['filename'] }}</td>
            <td><a href="{{ url_for('transcription.transcript_detail', tid=t['id']) }}">Lihat</a></td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="muted">Belum ada transkrip.</div>
    {% endif %}
  </section>

  <section class="card">
    <h2>🎧 Request Lagu Terbaru</h2>
    {% if reqs %}
      <table class="table">
        <thead><tr><th>Waktu</th><th>Pengirim</th><th>Pesan</th><th>Status</th></tr></thead>
        <tbody>
        {% for r in reqs %}
          <tr>
            <td class="muted">{{ r['created_at'] }}</td>
            <td>{{ r['username'] }} <span class="tag">{{ r['platform'] }}</span></td>
            <td>{{ r['message'] }}</td>
            <td><span class="pill">{{ r['status'] }}</span></td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <p><a class="btn" href="{{ url_for('main.requests_view') }}">Lihat Semua</a></p>
    {% else %}
      <div class="muted">Belum ada request.</div>
    {% endif %}
  </section>
</div>
{% endblock %}